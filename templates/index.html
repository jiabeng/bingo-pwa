<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Bingo Bingoï½œä»Šæ—¥å ±è¡¨ & æ¨è–¦</title>
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png" />
  <link rel="icon" sizes="192x192" href="/static/icons/icon-192.png" />
  <style>
    body{font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans TC",sans-serif; margin:16px;}
    h1{font-size:20px;margin:8px 0} h2{font-size:18px;margin:12px 0}
    .card{border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin:12px 0;box-shadow:0 1px 2px rgba(0,0,0,.04);} 
    .pill{display:inline-block;background:#eef;border-radius:999px;padding:4px 8px;margin:2px;}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border:1px solid #e5e7eb;padding:6px 8px;text-align:center}
    .muted{color:#6b7280;font-size:12px}
  </style>
</head>
<body>
  <h1>ğŸ¯ Bingo Bingo ä»Šæ—¥å³æ™‚å ±è¡¨ï¼ˆPWAï¼‰</h1>
  <div class="muted">è³‡æ–™ä»¥å°å½©å®˜ç¶² API ç‚ºæº–ã€‚è«‹ç†æ€§å°æ³¨ã€‚</div>

  <div id="summary" class="card">è¼‰å…¥ä¸­â€¦</div>
  <div id="recommend" class="card"></div>
  <div id="hot" class="card"></div>
  <div id="last20" class="card"></div>

<script>
  async function loadToday(){
    const res = await fetch('/api/today', {cache:'no-store'});
    const data = await res.json();
    if(!data.ok){ document.getElementById('summary').innerHTML='å°šç„¡è³‡æ–™'; return; }
    const s = data; const latest = s.latest;
    document.getElementById('summary').innerHTML = `
      <h2>æ‘˜è¦</h2>
      <div>ä»Šæ—¥ç´¯ç©æœŸæ•¸ï¼š<b>${s.today_count}</b></div>
      <div>æœ€æ–°æœŸåˆ¥ï¼š<b>${latest? latest.draw_term : '-'}</b> / æœ€æ–°è¶…ç´šçè™Ÿï¼š<b>${latest? latest.super_number : '-'}</b></div>
      <div class="muted">æ›´æ–°æ™‚é–“ï¼š${new Date().toLocaleString()}</div>
    `;
    document.getElementById('recommend').innerHTML = `
      <h2>ä¸‹æ³¨è™Ÿç¢¼æ¨è–¦</h2>
      <div>å–®æŠ¼ï¼š${s.recommend.pick1.map(n=>`<span class="pill">${n}</span>`).join('') || '-'}</div>
      <div>ä¸‰æŠ¼ï¼š${s.recommend.pick3.map(n=>`<span class="pill">${n}</span>`).join('') || '-'}</div>
      <div>äº”æŠ¼ï¼š${s.recommend.pick5.map(n=>`<span class="pill">${n}</span>`).join('') || '-'}</div>
      <div class="muted">é‚è¼¯ï¼š${s.recommend.rationale}</div>
    `;
    const topRows = s.freq_top.map((x,i)=>`<tr><td>${i+1}</td><td>${x.number}</td><td>${x.count}</td></tr>`).join('');
    document.getElementById('hot').innerHTML = `
      <h2>ä»Šæ—¥ç†±åº¦ï¼ˆTopï¼‰</h2>
      <table><thead><tr><th>æ’å</th><th>è™Ÿç¢¼</th><th>æ¬¡æ•¸</th></tr></thead><tbody>${topRows||'<tr><td colspan="3">å°šç„¡è³‡æ–™</td></tr>'}</tbody></table>
    `;
    const l20 = s.last20.slice().reverse().map(n=>`<span class="pill">${n}</span>`).join('');
    const rec = s.recency_unique.map(n=>`<span class="pill">${n}</span>`).join('');
    document.getElementById('last20').innerHTML = `
      <h2>è¿‘ 20 æœŸè¶…ç´šçè™Ÿï¼ˆæ–°â†’èˆŠï¼‰</h2>
      <div>${l20||'-'}</div>
      <h2>å»é‡åºåˆ—ï¼ˆæ–°â†’èˆŠï¼‰</h2>
      <div>${rec||'-'}</div>
    `;
  }
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('/sw.js').catch(console.error); }
  loadToday(); setInterval(loadToday, 30000);
</script>
</body>
</html>
